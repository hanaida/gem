<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보석 강화 시뮬레이터</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .status { font-size: 24px; margin-top: 20px; font-weight: bold; }
        .success { color: green; }
        .keep { color: blue; }
        .fail { color: orange; }
        .destroy { color: red; }
        .item-status { font-size: 18px; margin-top: 10px; color: purple; }
        .probability { font-size: 16px; margin-top: 10px; color: darkblue; }
        button:disabled { background-color: gray; color: white; cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>보석 강화 시뮬레이터</h1>
    <p>현재 강화 단계: <span id="currentLevel">1</span></p>
    <p class="probability" id="probabilityInfo">강화 확률을 불러오는 중...</p>
    <p class="status" id="statusMessage">강화 대기 중...</p>
    <p class="item-status" id="itemStatus">현재 적용 아이템: 없음</p>

    <button onclick="upgrade()">강화하기</button>
    <br><br>
    <button id="buffButton" onclick="toggleItem('buff')">마법의 연마제</button>
    <button id="nerfButton" onclick="toggleItem('nerf')">명장의 망치</button>
    <button id="doomBookButton" onclick="toggleItem('doom')">파멸의 제작서</button>
    <button id="goblinLensButton" onclick="toggleItem('lens')">고블린의 렌즈</button>

    <script>
        let level = 1; 
        const maxLevel = 16;
        let successMultiplier = 1;
        let failMultiplier = 1;
        let usedBuff = false;
        let usedNerf = false;
        let usedDoom = false;
        let usedLens = false;

        const probabilities = {
            1: { success: 100, fail: 0, destroy: 0 },
            2: { success: 81.5, fail: 0, destroy: 0 },
            3: { success: 66.4, fail: 0, destroy: 0 },
            4: { success: 54.1, fail: 0, destroy: 0 },
            5: { success: 44.1, fail: 27.9, destroy: 0 },
            6: { success: 36, fail: 35.2, destroy: 0 },
            7: { success: 29.3, fail: 42.4, destroy: 0 },
            8: { success: 23.9, fail: 49.5, destroy: 0 },
            9: { success: 17.4, fail: 59.6, destroy: 2 },
            10: { success: 15.6, fail: 17.4, destroy: 3.5 },
            11: { success: 15.1, fail: 65.3, destroy: 6.1 },
            12: { success: 16.6, fail: 63.5, destroy: 10.7 },
            13: { success: 3.7, fail: 68.8, destroy: 18.8 },
            14: { success: 7, fail: 60.2, destroy: 32.8 },
            15: { success: 5, fail: 56, destroy: 39 }
        };

        function updateProbabilityDisplay() {
            let { success, fail, destroy } = probabilities[level];
            success *= successMultiplier;
            fail *= failMultiplier;

            if (usedDoom) {
                fail = 0;
                let total = success + destroy;
                success = (success / total) * 100;
                destroy = (destroy / total) * 100;
            }

            if (usedLens) {
                fail = 0;
                destroy = 0;
            }

            let keep = Math.max(0, 100 - (success + fail + destroy));

            document.getElementById("probabilityInfo").innerText =
                `제련 성공: ${success.toFixed(1)}% | 등급 하락: ${fail.toFixed(1)}% | 보석 파괴: ${destroy.toFixed(1)}%`;
        }

        function upgrade() {
            if (level >= maxLevel) {
                updateStatus("이미 최대 단계입니다!", "keep");
                return;
            }

            let { success, fail, destroy } = probabilities[level];

            success *= successMultiplier;
            fail *= failMultiplier;

            if (usedDoom) {
                fail = 0;
                let total = success + destroy;
                success = (success / total) * 100;
                destroy = (destroy / total) * 100;
            }

            if (usedLens) {
                fail = 0;
                destroy = 0;
            }

            let keep = Math.max(0, 100 - (success + fail + destroy));

            let chance = Math.random() * 100;

            if (chance < success) {
                level++;
                updateStatus(`강화 성공! 현재 단계: ${level}`, "success");
            } else if (chance < success + keep) {
                updateStatus(`강화 유지. 현재 단계: ${level}`, "keep");
            } else if (chance < success + keep + fail) {
                level = Math.max(1, level - 1);
                updateStatus(`강화 실패! 현재 단계: ${level}`, "fail");
            } else {
                level = 1;
                updateStatus(`보석 파괴! 현재 단계: 1`, "destroy");
            }

            document.getElementById("currentLevel").innerText = level;

            successMultiplier = 1;
            failMultiplier = 1;
            usedBuff = usedNerf = usedDoom = usedLens = false;
            updateItemStatus("현재 적용 아이템: 없음");
            updateProbabilityDisplay();
        }

        function toggleItem(type) {
            if (type === "buff") {
                usedBuff = !usedBuff;
                successMultiplier = usedBuff ? 1.5 : 1;
                updateItemStatus(usedBuff ? "마법의 연마제 적용됨" : "마법의 연마제 해제됨");
            } else if (type === "nerf") {
                usedNerf = !usedNerf;
                failMultiplier = usedNerf ? 0.71 : 1;
                updateItemStatus(usedNerf ? "명장의 망치 적용됨" : "명장의 망치 해제됨");
            } else if (type === "doom") {
                usedDoom = !usedDoom;
                updateItemStatus(usedDoom ? "파멸의 제작서 적용됨" : "파멸의 제작서 해제됨");
            } else if (type === "lens") {
                usedLens = !usedLens;
                updateItemStatus(usedLens ? "고블린의 렌즈 적용됨" : "고블린의 렌즈 해제됨");
            }
            updateProbabilityDisplay();
        }

        function updateStatus(message, type) {
            let statusMessage = document.getElementById("statusMessage");
            statusMessage.innerText = message;
            statusMessage.className = "status " + type;
        }

        function updateItemStatus(message) {
            document.getElementById("itemStatus").innerText = message;
        }

        updateProbabilityDisplay();
    </script>

</body>
</html>